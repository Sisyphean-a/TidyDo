# 待办事项管理

<cite>
**本文档引用的文件**
- [TodoEditDialog.vue](file://src\model\TodoEditDialog.vue)
- [useTodosStore.js](file://src\stores\useTodosStore.js)
- [todoService.js](file://src\services\todoService.js)
</cite>

## 目录
1. [简介](#简介)
2. [核心组件](#核心组件)
3. [CRUD操作实现机制](#crud操作实现机制)
4. [用户交互流程与后端服务调用逻辑](#用户交互流程与后端服务调用逻辑)
5. [TodoEditDialog组件使用方式](#todoeditdialog组件使用方式)
6. [useTodosStore状态管理逻辑](#usetodosstore状态管理逻辑)
7. [todoService数据持久化过程](#todoservice数据持久化过程)
8. [组合式API触发状态变更](#组合式api触发状态变更)
9. [常见问题排查方法](#常见问题排查方法)
10. [性能优化建议](#性能优化建议)

## 简介
本项目实现了一个完整的待办事项管理功能，支持创建、编辑、删除和归档等CRUD操作。系统采用分层架构设计，包含UI组件层、状态管理层和服务层，通过Pinia进行状态管理，使用IndexedDB进行数据持久化存储。

## 核心组件
系统主要由以下核心组件构成：
- **TodoEditDialog**: 待办事项编辑弹窗组件
- **useTodosStore**: 待办事项状态管理Store
- **todoService**: 数据持久化服务

**Section sources**
- [TodoEditDialog.vue](file://src\model\TodoEditDialog.vue)
- [useTodosStore.js](file://src\stores\useTodosStore.js)
- [todoService.js](file://src\services\todoService.js)

## CRUD操作实现机制
系统实现了完整的CRUD操作机制，包括创建、读取、更新和删除待办事项。

```mermaid
flowchart TD
A[用户操作] --> B{操作类型}
B --> |创建| C[调用createTodo]
B --> |读取| D[调用loadTodos]
B --> |更新| E[调用updateTodo]
B --> |删除| F[调用deleteTodo]
C --> G[生成唯一ID]
G --> H[创建待办项]
H --> I[保存到服务层]
D --> J[从服务层获取数据]
J --> K[更新状态]
E --> L[更新待办项]
L --> M[保存到服务层]
F --> N[删除待办项]
N --> O[更新状态]
```

**Diagram sources**
- [useTodosStore.js](file://src\stores\useTodosStore.js#L4-L169)
- [todoService.js](file://src\services\todoService.js#L139-L313)

## 用户交互流程与后端服务调用逻辑
用户交互流程与后端服务调用之间通过清晰的逻辑进行连接，确保数据的一致性和完整性。

```mermaid
sequenceDiagram
participant UI as "UI组件"
participant Store as "useTodosStore"
participant Service as "todoService"
UI->>Store : 调用createTodo()
Store->>Service : 调用TodoItemService.save()
Service->>Service : 生成唯一ID
Service->>Service : 创建待办项
Service->>Service : 保存到IndexedDB
Service-->>Store : 返回保存结果
Store->>Store : 调用loadTodos()
Store->>Service : 调用TodoItemService.getAll()
Service-->>Store : 返回所有待办项
Store-->>UI : 更新状态
```

**Diagram sources**
- [useTodosStore.js](file://src\stores\useTodosStore.js#L4-L169)
- [todoService.js](file://src\services\todoService.js#L139-L313)

## TodoEditDialog组件使用方式
TodoEditDialog是一个可复用的弹窗组件，用于创建和编辑待办事项。

```mermaid
classDiagram
class TodoEditDialog {
+modelValue : Boolean
+item : Object
+categoryId : String
+categories : Array
-formRef : Ref
-isFormValid : Ref
-isLoading : Ref
-formData : Ref
+isVisible : Computed
+isCreateMode : Computed
+initFormData()
+handleSave()
+handleDelete()
+handleClose()
+loadConfig()
}
TodoEditDialog --> useTodosStore : "依赖"
TodoEditDialog --> todoService : "依赖"
```

**Diagram sources**
- [TodoEditDialog.vue](file://src\model\TodoEditDialog.vue#L1-L452)

## useTodosStore状态管理逻辑
useTodosStore是基于Pinia的状态管理模块，负责管理待办事项的所有状态。

```mermaid
classDiagram
class useTodosStore {
+todos : Ref
+isLoading : Ref
+showArchived : Ref
+allTodos : Computed
+activeTodos : Computed
+archivedTodos : Computed
+totalTodosCount : Computed
+getTodosByCategoryId : Computed
+todoCounts : Computed
+loadTodos()
+createTodo()
+updateTodo()
+deleteTodo()
+updateTodoStatus()
+toggleTodoArchived()
+toggleShowArchived()
+resetState()
}
useTodosStore --> todoService : "使用"
```

**Diagram sources**
- [useTodosStore.js](file://src\stores\useTodosStore.js#L4-L169)

## todoService数据持久化过程
todoService负责与IndexedDB进行交互，实现数据的持久化存储。

```mermaid
flowchart TD
A[数据操作] --> B{操作类型}
B --> |保存| C[调用save方法]
B --> |获取| D[调用getAll方法]
B --> |删除| E[调用delete方法]
C --> F[获取现有数据]
F --> G[查找是否存在]
G --> |存在| H[更新数据]
G --> |不存在| I[添加新数据]
H --> J[序列化数据]
I --> J
J --> K[保存到IndexedDB]
D --> L[从IndexedDB获取]
L --> M[返回数据]
E --> N[获取现有数据]
N --> O[过滤删除项]
O --> P[保存到IndexedDB]
```

**Diagram sources**
- [todoService.js](file://src\services\todoService.js#L139-L313)

## 组合式API触发状态变更
通过组合式API实现状态变更的触发和处理。

```mermaid
sequenceDiagram
participant Component as "组件"
participant Composable as "组合式函数"
participant Store as "状态Store"
Component->>Composable : 调用操作函数
Composable->>Store : 调用Action
Store->>Store : 更新状态
Store-->>Composable : 返回结果
Composable-->>Component : 返回结果
Note over Component,Store : 状态变更完成
```

**Diagram sources**
- [useTodosStore.js](file://src\stores\useTodosStore.js#L4-L169)
- [TodoEditDialog.vue](file://src\model\TodoEditDialog.vue#L1-L452)

## 常见问题排查方法
针对常见的数据同步和状态更新问题，提供以下排查方法。

### 数据同步延迟
当出现数据同步延迟时，检查以下方面：
- 确认`loadTodos()`是否在每次数据变更后被正确调用
- 检查IndexedDB操作是否成功完成
- 验证网络连接状态（如果使用远程存储）

### 状态更新失败
当状态更新失败时，按照以下步骤排查：
1. 检查错误日志中的具体错误信息
2. 验证数据格式是否符合预期
3. 确认ID生成是否正常
4. 检查数据序列化过程

**Section sources**
- [useTodosStore.js](file://src\stores\useTodosStore.js#L4-L169)
- [todoService.js](file://src\services\todoService.js#L139-L313)

## 性能优化建议
为提升系统性能，建议采用以下优化策略。

### 列表渲染的虚拟滚动策略
对于大量待办事项的渲染，建议使用虚拟滚动策略：

```mermaid
flowchart TD
A[用户滚动] --> B{是否需要更新}
B --> |是| C[计算可视区域]
C --> D[获取可视区域数据]
D --> E[渲染可视区域项]
E --> F[设置占位高度]
F --> G[完成渲染]
B --> |否| H[保持当前状态]
```

**Diagram sources**
- [todoService.js](file://src\services\todoService.js#L139-L313)
- [useTodosStore.js](file://src\stores\useTodosStore.js#L4-L169)